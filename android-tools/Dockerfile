FROM ubuntu:18.04

ENV DEBIAN_FRONTEND noninteractive
ENV LC_ALL C.UTF-8
ENV LANG C.UTF-8
ENV PATH $PATH:/opt/platform-tools

ENV APKTOOL_VERSION "2.3.4"
ENV DROZER_VERSION "2.4.4"
ENV SSH_PASSWORD "toor"

RUN apt update && apt upgrade -yf
RUN apt install -y  software-properties-common 
RUN	apt install -y unzip aapt zipalign wget vim openssh-server ssh curl git build-essential
RUN	apt install -y default-jre default-jdk 
RUN apt install -y python3.7 python3-pip android-tools-adb 
RUN apt-get -y install bash-completion python2.7 python-dev python-protobuf python-openssl python-twisted 
RUN apt clean
RUN rm -rf /var/lib/apt/lists/* 

### Installing objection and Frida ###
RUN pip3 install -U pip && \
    pip install objection
RUN mkdir /data


WORKDIR /opt

### Installing apktool ###

RUN wget https://dl.google.com/android/repository/platform-tools-latest-linux.zip
RUN unzip platform-tools-latest-linux.zip
RUN rm -rf platform-tools-latest-linux.zip 
RUN wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool -O /usr/local/bin/apktool 
RUN wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_${APKTOOL_VERSION}.jar -O /usr/local/bin/apktool.jar 
RUN chmod +x /usr/local/bin/apktool /usr/local/bin/apktool.jar

### Installing Drozer ###

# Download the Drozer console
RUN wget -c "https://github.com/FSecureLABS/drozer/releases/download/2.4.4/drozer_${DROZER_VERSION}.deb"

# Install the Drozer console
RUN dpkg -i drozer_${DROZER_VERSION}.deb
RUN rm *.deb

# Port forwarding required by drozer
RUN echo "alias drozer-forward='adb forward tcp:31415 tcp:31415'" >> /root/.bashrc

# Alias for Drozer
RUN echo "alias drozer='drozer console connect'" >> /root/.bashrc

# Install Jadx
RUN git clone https://github.com/skylot/jadx.git
RUN cd jadx && ./gradlew dist
